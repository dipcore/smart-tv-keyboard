/*! smartTvKeyboard 08-01-2014 */
!function(a){"use strict";var b=function(a,c,d){return(b=document.getElementsByClassName?function(a,b,c){c=c||document;for(var d,e=c.getElementsByClassName(a),f=b?new RegExp("\\b"+b+"\\b","i"):null,g=[],h=0,i=e.length;i>h;h+=1)d=e[h],(!f||f.test(d.nodeName))&&g.push(d);return g}:document.evaluate?function(a,b,c){b=b||"*",c=c||document;for(var d,e,f=a.split(" "),g="",h="http://www.w3.org/1999/xhtml",i=document.documentElement.namespaceURI===h?h:null,j=[],k=0,l=f.length;l>k;k+=1)g+="[contains(concat(' ', @class, ' '), ' "+f[k]+" ')]";try{d=document.evaluate(".//"+b+g,c,i,0,null)}catch(m){d=document.evaluate(".//"+b+g,c,null,0,null)}for(;e=d.iterateNext();)j.push(e);return j}:function(a,b,c){b=b||"*",c=c||document;for(var d,e,f=a.split(" "),g=[],h="*"===b&&c.all?c.all:c.getElementsByTagName(b),i=[],j=0,k=f.length;k>j;j+=1)g.push(new RegExp("(^|\\s)"+f[j]+"(\\s|$)"));for(var l=0,m=h.length;m>l;l+=1){d=h[l],e=!1;for(var n=0,o=g.length;o>n&&(e=g[n].test(d.className),e);n+=1);e&&i.push(d)}return i})(a,c,d)},c={lang:"eng",mode:"unshift",languages:{},selected:null,x:null,y:null,titleElement:null,inputElement:null,keyboardElement:null,cursorPosition:0,defaultConfig:{id:null,input:"text",title:null,destroyOnExit:!0,navKeys:{LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,EXIT:8}},addLanguage:function(a,b){this.languages[a]=b},getLanguage:function(a){return this.languages[a]},setLanguage:function(a){this.lang=a},listLanguages:function(){return Object.keys(this.languages)},toggleLanguage:function(){for(var a=this,b=a.listLanguages(),c=b[0],d=0;d<b.length;d++)a.lang===b[d]&&b[d+1]&&(c=b[d+1]);return a.lang=c,c},setMode:function(a){this.mode=a},listModes:function(){return Object.keys(this.languages[this.lang])},toggleMode:function(){for(var a=this,b=a.listModes(),c=b[0],d=0;d<b.length;d++)a.mode===b[d]&&b[d+1]&&(c=b[d+1]);return a.mode=c,c},btnLength:{normal:1,"long":2,"x-long":6},getButton:function(a,c){var d=b(a+"_"+c);return d?d[0]:void 0},getButtonLength:function(a,b){var c,d=this,e=this.getButton(a,b);for(var f in d.btnLength){var g=new RegExp(f,"g");g.test(e.className)&&(c=d.btnLength[f])}return c},getButtonValue:function(a,b){var c=this,d=c.getButton(a,b),e=d.getAttribute("row"),f=d.getAttribute("col");return c.languages[c.lang][c.mode][e][f].value},isDisabledButton:function(a,b){var c=this.getButton(a,b);return!c||/.*disabled.*/i.test(c.className)},select:function(a,b){var c=this.getButton(this.x,this.y);c.className=c.className.replace(/\bselected\b/,"");var d=this.getButton(a,b);d.className=d.className.replace(/\s+$/,""),d.className+=" selected",this.x=a,this.y=b},getXY:function(a,b,c){var d=this;switch(c){case"LEFT":a-=d.getButtonLength(a,b),0>a&&(a=14);break;case"RIGHT":a+=d.getButtonLength(a,b),a>14&&(a=0);break;case"UP":--b<0&&(b=4);break;case"DOWN":++b>4&&(b=0)}return d.isDisabledButton(a,b)?d.getXY(a,b,c):[a,b]},renderGrid:function(){var a=this,b=0,c=0,d=document.createElement("div");a.grid&&a.grid.parentNode.removeChild(a.grid);for(var e in a.languages[a.lang][a.mode]){var f=a.languages[a.lang][a.mode][e],g=document.createElement("div");g.className="key-row";for(var h in f){var i=f[h],j=document.createElement("button");j.setAttribute("row",e),j.setAttribute("col",h),j.className=["btn","btn-default",i.length,i.color].join(" ");for(var k=0;k<a.btnLength[i.length];k++)j.className+=" "+b+"_"+c,b++;j.innerHTML=i.text||"&nbsp;",g.appendChild(j)}c++,b=0,d.appendChild(g)}a.grid=d,a.keyboardElement.appendChild(d),a.x=a.x||0,a.y=a.y||0,a.select(a.x,a.y)},renderInputBox:function(){this.inputElement="text"===this.config.input?document.createElement("input"):"password"===this.config.input?document.createElement("input"):document.createElement("textarea"),this.inputElement.className="input-box",this.keyboardElement.appendChild(this.inputElement),this.inputElement.focus()},setCursorPosition:function(a){var b=this.inputElement;if(b&&b.setSelectionRange)b.setSelectionRange(a,a);else if(b&&b.createTextRange){var c=b.createTextRange();c.collapse(!0),c.moveEnd("character",a),c.moveStart("character",a),c.select()}},cursorMove:function(a){var b=this;b.inputElement&&(b.cursorPosition+=a,b.cursorPosition<0?b.cursorPosition=0:b.cursorPosition>b.inputElement.value.length&&(b.cursorPosition=b.inputElement.value.length),b.setCursorPosition(b.cursorPosition))},renderTitle:function(){this.config.title&&(this.titleElement=document.createElement("h3"),this.titleElement.className="text-center title",this.titleElement.innerHTML=this.config.title,this.keyboardElement.appendChild(this.titleElement))},renderAll:function(){this.renderTitle(),this.renderInputBox(),this.renderGrid()},enterCallback:function(a){this.config.onEnter&&"function"==typeof this.config.onEnter&&this.config.onEnter(a)},cancelCallback:function(a){this.config.onCancel&&"function"==typeof this.config.onCancel&&this.config.onCancel(a)},onKeyUp:function(a){var b=c;a=a||window.event;var d,e=b.config.navKeys;switch(a.keyCode){case e.UP:d=b.getXY(b.x,b.y,"UP"),b.select(d[0],d[1]);break;case e.DOWN:d=b.getXY(b.x,b.y,"DOWN"),b.select(d[0],d[1]);break;case e.LEFT:d=b.getXY(b.x,b.y,"LEFT"),b.select(d[0],d[1]);break;case e.RIGHT:d=b.getXY(b.x,b.y,"RIGHT"),b.select(d[0],d[1]);break;case e.EXIT:b.cancelCallback(b.inputElement.value),b.destroy();break;case e.ENTER:var f=b.getButtonValue(b.x,b.y);switch(f){case"&&cursorMoveLeft":b.cursorMove(-1);break;case"&&cursorMoveRight":b.cursorMove(1);break;case"&&clear":b.inputElement.value="",b.cursorPosition=0;break;case"&&back":b.cursorMove(-1),b.inputElement.value=b.inputElement.value.slice(0,b.cursorPosition)+b.inputElement.value.slice(b.cursorPosition+1),b.setCursorPosition(b.cursorPosition);break;case"&&switchMode":b.toggleMode(),b.renderGrid();break;case"&&switchLanguage":b.toggleLanguage(),b.renderGrid();break;case"&&enter":b.enterCallback(b.inputElement.value),b.destroy();break;case"&&cancel":b.cancelCallback(b.inputElement.value),b.destroy();break;default:b.cursorPosition++,b.inputElement.value=b.inputElement.value.slice(0,b.cursorPosition)+f+b.inputElement.value.slice(b.cursorPosition),b.setCursorPosition(b.cursorPosition)}}return a.preventDefault(),!1},onBlur:function(){this.focus()},bindNavKeys:function(){this.inputElement.addEventListener("keydown",this.onKeyUp),this.inputElement.addEventListener("blur",this.onBlur)},unBindNavKeys:function(){this.inputElement.removeEventListener("keydown",this.onKeyUp),this.inputElement.removeEventListener("blur",this.onBlur)},clone:function(){function a(){}return function(b){return a.prototype=b,new a}}(),extend:function(a,b){var c=this.clone(a);for(var d in b)c[d]=b[d];return c},init:function(a){this.config=this.extend(this.defaultConfig,a),this.config.id?this.keyboardElement=document.getElementById(this.config.id):(this.keyboardElement=document.createElement("div"),this.keyboardElement.className="smart-tv-keyboard-modal",document.body.appendChild(this.keyboardElement),this.backdropElement=document.createElement("div"),this.backdropElement.className="smart-tv-keyboard-modal-backdrop",document.body.appendChild(this.backdropElement)),this.keyboardElement.className+=" smart-tv-keyboard",this.setMode(this.mode),this.renderAll(),this.bindNavKeys(),this.config.value&&(this.inputElement.value=this.config.value)},destroy:function(){if(this.unBindNavKeys(),this.config.destroyOnExit){if(this.config.id)for(;this.keyboardElement.hasChildNodes();)this.keyboardElement.removeChild(this.keyboardElement.lastChild);else this.keyboardElement.parentNode.removeChild(this.keyboardElement),this.backdropElement.parentNode.removeChild(this.backdropElement);this.keyboardElement.className=this.keyboardElement.className.replace("smart-tv-keyboard","")}delete this.grid}};c.VERSION="0.0.6",a.smartTvKeyboard=c}(this);