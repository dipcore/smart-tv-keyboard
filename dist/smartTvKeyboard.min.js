/*! smartTvKeyboard 22-12-2013 */
!function(a){"use strict";var b=function(a,c,d){return(b=document.getElementsByClassName?function(a,b,c){c=c||document;for(var d,e=c.getElementsByClassName(a),f=b?new RegExp("\\b"+b+"\\b","i"):null,g=[],h=0,i=e.length;i>h;h+=1)d=e[h],(!f||f.test(d.nodeName))&&g.push(d);return g}:document.evaluate?function(a,b,c){b=b||"*",c=c||document;for(var d,e,f=a.split(" "),g="",h="http://www.w3.org/1999/xhtml",i=document.documentElement.namespaceURI===h?h:null,j=[],k=0,l=f.length;l>k;k+=1)g+="[contains(concat(' ', @class, ' '), ' "+f[k]+" ')]";try{d=document.evaluate(".//"+b+g,c,i,0,null)}catch(m){d=document.evaluate(".//"+b+g,c,null,0,null)}for(;e=d.iterateNext();)j.push(e);return j}:function(a,b,c){b=b||"*",c=c||document;for(var d,e,f=a.split(" "),g=[],h="*"===b&&c.all?c.all:c.getElementsByTagName(b),i=[],j=0,k=f.length;k>j;j+=1)g.push(new RegExp("(^|\\s)"+f[j]+"(\\s|$)"));for(var l=0,m=h.length;m>l;l+=1){d=h[l],e=!1;for(var n=0,o=g.length;o>n&&(e=g[n].test(d.className),e);n+=1);e&&i.push(d)}return i})(a,c,d)},c={lang:"eng",mode:"unshift",languages:{},selected:null,x:null,y:null,titleElement:null,inputElement:null,keyboardElement:null,cursorPosition:0,config:{id:"keyboard",input:"text",title:null,navKeys:{LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,EXIT:8}},addLanguage:function(a,b){this.languages[a]=b},getLanguage:function(a){return this.languages[a]},setLanguage:function(a){this.lang=a},listLanguages:function(){return Object.keys(this.languages)},toggleLanguage:function(){for(var a=this,b=a.listLanguages(),c=b[0],d=0;d<b.length;d++)a.lang===b[d]&&b[d+1]&&(c=b[d+1]);return a.lang=c,c},setMode:function(a){this.mode=a},listModes:function(){return Object.keys(this.languages[this.lang])},toggleMode:function(){for(var a=this,b=a.listModes(),c=b[0],d=0;d<b.length;d++)a.mode===b[d]&&b[d+1]&&(c=b[d+1]);return a.mode=c,c},btnLength:{normal:1,"long":2,"x-long":6},getButton:function(a,c){var d=b(a+"_"+c);return d?d[0]:void 0},getButtonLength:function(a,b){var c,d=this,e=this.getButton(a,b);for(var f in d.btnLength){var g=new RegExp(f,"g");g.test(e.className)&&(c=d.btnLength[f])}return c},getButtonValue:function(a,b){var c=this,d=c.getButton(a,b),e=d.getAttribute("row"),f=d.getAttribute("col");return c.languages[c.lang][c.mode][e][f].value},isDisabledButton:function(a,b){var c=this.getButton(a,b);return!c||/.*disabled.*/i.test(c.className)},select:function(a,b){var c=this.getButton(this.x,this.y);c.className=c.className.replace(/\bselected\b/,"");var d=this.getButton(a,b);d.className=d.className.replace(/\s+$/,""),d.className+=" selected",this.x=a,this.y=b},getXY:function(a,b,c){var d=this;switch(c){case"LEFT":a-=d.getButtonLength(a,b),0>a&&(a=14);break;case"RIGHT":a+=d.getButtonLength(a,b),a>14&&(a=0);break;case"UP":--b<0&&(b=4);break;case"DOWN":++b>4&&(b=0)}return d.isDisabledButton(a,b)?d.getXY(a,b,c):[a,b]},renderGrid:function(){var a=this,b=0,c=0,d=document.createElement("div");a.grid&&a.grid.parentNode.removeChild(a.grid);for(var e in a.languages[a.lang][a.mode]){var f=a.languages[a.lang][a.mode][e],g=document.createElement("div");g.className="row";var h=document.createElement("div");h.className="col-sm-12",g.appendChild(h);for(var i in f){var j=f[i],k=document.createElement("button");k.setAttribute("row",e),k.setAttribute("col",i),k.className=["btn","btn-default",j.length,j.color].join(" ");for(var l=0;l<a.btnLength[j.length];l++)k.className+=" "+b+"_"+c,b++;k.innerHTML=j.text||"&nbsp;",h.appendChild(k)}c++,b=0,d.appendChild(g)}a.grid=d,a.keyboardElement.appendChild(d),a.x=a.x||0,a.y=a.y||0,a.select(a.x,a.y)},renderInputBox:function(){this.inputElement="text"===this.config.input?document.createElement("input"):"password"===this.config.input?document.createElement("input"):document.createElement("textarea"),this.inputElement.className="form-control input-box",this.keyboardElement.appendChild(this.inputElement),this.inputElement.focus(),this.inputElement.onblur=function(){this.focus()}},setCursorPosition:function(a){var b=this.inputElement;if(b&&b.setSelectionRange)b.setSelectionRange(a,a);else if(b&&b.createTextRange){var c=b.createTextRange();c.collapse(!0),c.moveEnd("character",a),c.moveStart("character",a),c.select()}},cursorMove:function(a){var b=this;b.inputElement&&(b.cursorPosition+=a,b.cursorPosition<0?b.cursorPosition=0:b.cursorPosition>b.inputElement.value.length&&(b.cursorPosition=b.inputElement.value.length),b.setCursorPosition(b.cursorPosition))},renderTitle:function(){this.config.title&&(this.titleElement=document.createElement("h3"),this.titleElement.className="text-center title",this.titleElement.innerHTML=this.config.title,this.keyboardElement.appendChild(this.titleElement))},renderAll:function(){this.renderTitle(),this.renderInputBox(),this.renderGrid()},bindNavKeys:function(){var a=this;this.inputElement.onkeydown=function(a){return a.preventDefault(),!1},this.inputElement.onkeyup=function(b){b=b||window.event;var c,d=a.config.navKeys;switch(b.keyCode){case d.UP:c=a.getXY(a.x,a.y,"UP"),a.select(c[0],c[1]);break;case d.DOWN:c=a.getXY(a.x,a.y,"DOWN"),a.select(c[0],c[1]);break;case d.LEFT:c=a.getXY(a.x,a.y,"LEFT"),a.select(c[0],c[1]);break;case d.RIGHT:c=a.getXY(a.x,a.y,"RIGHT"),a.select(c[0],c[1]);break;case d.ENTER:var e=a.getButtonValue(a.x,a.y);switch(e){case"&&cursorMoveLeft":a.cursorMove(-1);break;case"&&cursorMoveRight":a.cursorMove(1);break;case"&&clear":a.inputElement.value="",a.cursorPosition=0;break;case"&&back":a.cursorMove(-1),a.inputElement.value=a.inputElement.value.slice(0,a.cursorPosition)+a.inputElement.value.slice(a.cursorPosition+1),a.setCursorPosition(a.cursorPosition);break;case"&&switchMode":a.toggleMode(),a.renderGrid();break;case"&&switchLanguage":a.enterCallback(a.inputElement.value);break;case"&&enter":a.cancelCallback(a.inputElement.value);break;case"&&cancel":a.toggleLanguage(),a.renderGrid();break;default:a.cursorPosition++,a.inputElement.value=a.inputElement.value.slice(0,a.cursorPosition)+e+a.inputElement.value.slice(a.cursorPosition),a.setCursorPosition(a.cursorPosition)}}return b.preventDefault(),!1}},extend:function(a,b){a=a||{},b=b||{};for(var c in b)a[c]=b[c];return a},init:function(a){this.extend(this.config,a),this.keyboardElement=document.getElementById(this.config.id),this.keyboardElement.className="smart-tv-keyboard",this.setMode(this.mode),this.renderAll(),this.bindNavKeys()}};c.VERSION="0.0.1",a.smartTvKeyboard=c}(this);