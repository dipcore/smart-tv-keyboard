/*! smartTvKeyboard 18-05-2015 */
!function(a){"use strict";a.fn.smartTvKeyboard=function(b){return this.each(function(){function c(){a.extend(J,b),u=J.defLang||p()[0],v=J.defMode||q()[0],C=B.val().length,x="inline"===J.type?B.parent():a("body"),d()}function d(){B.on(J.openOn,e)}function e(){w||(y=B.clone().removeClass().addClass("smart-tv-keyboard-input"),w=a(F),w.find(".smart-tv-keyboard-input-section").append(y),y.val(B.val()),o(C),J.title?w.find(".smart-tv-keyboard-title").text(J.title):w.find(".smart-tv-keyboard-title").remove(),"inline"===J.type?(B.hide(),B.after(w)):(A=a(I),x.append(w),x.append(A),w.toggleClass("smart-tv-keyboard-modal",!0)),h(),g(),f())}function f(){y.on("keydown",function(a){a=a||window.event,J.useNavKeys&&l(a.keyCode),!J.useDirectEdit&&a.preventDefault()})}function g(){y.focus(),y.on("blur",function(){this.focus()})}function h(){var b=J.layouts[u],c=w.find(".smart-tv-keyboard-grid").empty(),d=0;for(var e in b[v]){var f=0,g=b[v][e],h=a(G);for(var j in g){var k=g[j],l=a(H);l.attr("data-size",k.length),l.addClass("smart-tv-keyboard-button-length-"+k.length),l.addClass("smart-tv-keyboard-button-color-"+k.color),l.text(k.text),i(l,k.value),h.append(l);for(var m=0;m<k.length;m++)l.addClass(f+"-"+d),f++}d++,c.append(h)}}function i(a,b){b&&a&&a.on("click",function(){k(b),j(a)})}function j(a){if(z&&z.toggleClass("smart-tv-keyboard-button-selected",!1),a){var b=/\d+\-\d+/.exec(a.attr("class"));if(b&&b[0]){var c=b[0].split("-");D=parseInt(c[0],10),E=parseInt(c[1],10),z=a}}else z=w.find("."+D+"-"+E);z.toggleClass("smart-tv-keyboard-button-selected",!0)}function k(a){var b;switch(a){case"&&cursorMoveLeft":n(-1);break;case"&&cursorMoveRight":n(1);break;case"&&clear":y.val(""),C=0;break;case"&&back":n(-1),b=y.val(),b=b.slice(0,C)+b.slice(C+1),y.val(b),o(C);break;case"&&switchMode":r(),h();break;case"&&switchLanguage":s(),h();break;case"&&enter":B.val(y.val()),J.onEnter&&J.onEnter(y.val()),B.show(),t();break;case"&&cancel":J.onCancel&&J.onCancel(y.val()),B.show(),t();break;default:C++,b=y.val(),b=b.slice(0,C)+a+b.slice(C),y.val(b),o(C)}}function l(a){var b=J.navKeys;switch(a){case b.UP:m("UP");break;case b.DOWN:m("DOWN");break;case b.LEFT:m("LEFT");break;case b.RIGHT:m("RIGHT");break;case b.EXIT:J.onCancel&&J.onCancel(y.val()),B.show(),t();break;case b.ENTER:w.find("."+D+"-"+E).click()}}function m(a){var b=J.layouts[u][v],c=b.length-1,d=-1;for(var e in b[E])d+=b[E][e].length;switch(a){case"LEFT":D=--D<0?d:D;break;case"RIGHT":D=++D>d?0:D;break;case"UP":E=--E<0?c:E;break;case"DOWN":E=++E>c?0:E}var f=w.find("."+D+"-"+E);return f.hasClass("smart-tv-keyboard-button-color-disabled")||z&&z.hasClass(D+"-"+E)?m(a):void j()}function n(a){var b=y.val();C+=a,0>C?C=0:C>b.length&&(C=b.length),o(C)}function o(a){var b=y[0];if(b.setSelectionRange)b.setSelectionRange(a,a);else if(b.createTextRange){var c=b.createTextRange();c.collapse(!0),c.moveEnd("character",a),c.moveStart("character",a),c.select()}}function p(){return Object.keys(J.layouts)}function q(){return Object.keys(J.layouts[u])}function r(){for(var a=q(),b=a[0],c=0;c<a.length;c++)v===a[c]&&a[c+1]&&(b=a[c+1]);return v=b,b}function s(){for(var a=p(),b=a[0],c=0;c<a.length;c++)u===a[c]&&a[c+1]&&(b=a[c+1]);return u=b,b}function t(){A&&A.remove(),w&&w.remove(),w=null}var u,v,w,x,y,z,A,B=a(this),C=0,D=0,E=0,F='<div class="smart-tv-keyboard"><div class="smart-tv-keyboard-title"></div><div class="smart-tv-keyboard-input-section"></div><div class="smart-tv-keyboard-grid"></div></div>',G='<div class="smart-tv-keyboard-row"></div>',H='<div class="smart-tv-keyboard-button"></div>',I='<div class="smart-tv-keyboard-backdrop"></div>',J={title:null,defLang:null,defMode:null,layouts:{},type:"inline",openOn:"click focus",onEnter:null,onCancel:null,useDirectEdit:!0,useNavKeys:!0,navKeys:{LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,EXIT:8}};c()})}}(window.jQuery||window.Zepto);